<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>全局导航守卫中检查元字段，校验是否登录</title>
	<style>
		.router-link-active {
			color: red;
		}
	</style>
</head>

<body>
	<script src="https://unpkg.com/vue/dist/vue.js"></script>
	<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>

	<div id="app">
		<h1>Hello App!</h1>
		<p>
			<router-link to="/user/foo">/user/foo</router-link>
			<router-link to="/user/foo/profile">/user/foo/profile</router-link>
			<router-link to="/user/foo/posts">/user/foo/posts</router-link>
		</p>
		<router-view></router-view>
	</div>

	<script>
		const User = {
			template: `
				<div class="user">
				<h2>User {{ $route.params.id }}</h2>
				<router-view></router-view>
				</div>
			`
		}
		const Login = {
			template: '<div>Login</div>'
		}
		const UserHome = {
			template: '<div>Home</div>'
		}
		const UserProfile = {
			template: '<div>Profile</div>'
		}
		const UserPosts = {
			template: '<div>Posts</div>'
		}
		const router = new VueRouter({
			routes: [
				{
					path: '/login',
					component: Login
				},
				{
					path: '/user/:id',
					component: User,
					children: [
						{
							path: '',
							component: UserHome
						},
						{
							path: 'profile',
							component: UserProfile,
							meta: {
								requiresAuth: true
							}
						},
						{
							path: 'posts',
							component: UserPosts
						}
					]
				}
			]
		})
		const isLoggedIn = false
		router.beforeEach((to, from, next) => {
			console.log('to', to)
			console.log('from', from)
			if (to.matched.some(record => record.meta.requiresAuth)) {
				// this route requires auth, check if logged in
				// if not, redirect to login page.
				if (!isLoggedIn) {
					next('/login')
				} else {
					next()
				}
			} else {
				next() // 确保一定要调用 next()
			}
		})

		const app = new Vue({
			router
		}).$mount('#app')
	</script>
</body>

</html>